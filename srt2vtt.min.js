document.addEventListener("DOMContentLoaded", function () { var videoElements = document.getElementsByTagName('video'); function convertSrtToVtt() { this.id = '_' + Math.random().toString(36).substr(2, 9); var self = document.getElementById(this.id); var tracks = document.querySelectorAll("#" + this.id + " track"); var subtitle = { data: { track: {} }, load: function (track) { subtitle.track = track; if (subtitle.isSrt(subtitle.track.src)) { var client = new XMLHttpRequest(); client.open('GET', subtitle.track.src); client.onreadystatechange = function () { subtitle.convert(client.responseText).then(function (file) { subtitle.track.src = file }) }; client.send() } }, convert: function (content) { var promise = new Promise(function (resolve, reject) { content = content.replace(/(\d+:\d+:\d+)+,(\d+)/g, '$1.$2'); content = "WEBVTT - Generated using SRT2VTT\r\n\r\n" + content; var blob = new Blob([content], { type: 'text/vtt' }); var file = window.URL.createObjectURL(blob); resolve(file) }); return promise }, isSrt: function (filename) { return filename.split('.').pop().toLowerCase() === 'srt' ? !0 : !1 }, isVTT: function (filename) { return filename.split('.').pop().toLowerCase() === 'vtt' ? !0 : !1 } }; for (var i = 0; i < tracks.length; i++) { subtitle.load(tracks[i]) } }; for (var i = 0; i < videoElements.length; i++) { videoElements[i].addEventListener('canplay', convertSrtToVtt) } });